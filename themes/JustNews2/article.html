<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width,viewport-fit=cover">
    <title>{{ &articleSingle.title }} - {{ &OPT.siteName }}</title>
    <meta name="keywords" content="{{ &keyWords }}" />
    <meta name="description" content="{{ &OPT.siteDescription }}" />

    <link rel='stylesheet' id='stylesheet-css' href='https://cdn.jsdelivr.net/gh/gdtool/cloudflare-workers-blog@master/themes/JustNews/files/main.css' type='text/css' media='all' />
    <link rel='stylesheet' id='font-awesome-css' href='https://cdn.jsdelivr.net/gh/gdtool/cloudflare-workers-blog@master/themes/JustNews/files/font-awesome.css?ver=6.1.2' type='text/css' media='all' />
    <link rel='stylesheet' id='wp-block-library-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/block-library/style.min.css?ver=5.6' type='text/css' media='all' />
    <link rel='stylesheet' id='wp-components-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/components/style.min.css?ver=5.6' type='text/css' media='all' />
    <link rel='stylesheet' id='wp-editor-font-css' href='https://fonts.geekzu.org/css?family=Noto+Serif%3A400%2C400i%2C700%2C700i&#038;ver=5.6' type='text/css' media='all' />
    <link rel='stylesheet' id='wp-block-editor-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/block-editor/style.min.css?ver=5.6' type='text/css' media='all' />
    <link rel='stylesheet' id='wp-nux-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/nux/style.min.css?ver=5.6' type='text/css' media='all' />
    <link rel='stylesheet' id='wp-editor-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/editor/style.min.css?ver=5.6' type='text/css' media='all' />
    <link rel='stylesheet' id='mux_video_block_style-css' href='https://cdn.jsdelivr.net/gh/newexsexy/wp@master/wp-content/plugins/ilab-media-tools/public/blocks/mediacloud-mux.blocks.style.min.css' type='text/css' media='all' />
    
    <link rel='stylesheet' id='emojify-css' href='https://cdn.jsdelivr.net/npm/emojify.js@1.1.0/dist/css/basic/emojify.min.css?ver=1.1.0' type='text/css' media='all' />
    <script type='text/javascript' src='https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.6/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/wpcom-cn/assets/fonts/icons-2.6.4.js?ver=6.1.2' id='wpcom-icons-js'></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.3.2/styles/tomorrow-night-bright.min.css">
    <script src='https://cdn.staticfile.org/highlight.js/10.3.2/highlight.min.js'></script>
    
    <!-- ä¿®å¤æ–‡ç« ç›®å½•æ ·å¼ -->
    <style>
    /* ç¡®ä¿æ•´ä½“å¸ƒå±€æ­£ç¡® */
    .container.wrap {
        display: flex;
        align-items: flex-start;
        position: relative;
        min-height: 100vh; /* å…³é”®ï¼šç¡®ä¿å®¹å™¨æœ‰è¶³å¤Ÿé«˜åº¦ */
    }
    
    .main {
        flex: 1;
        min-width: 0;
    }
    
    /* ä¿®å¤ä¾§è¾¹æ stickyå®šä½ */
    .sidebar {
        width: 300px;
        margin-left: 20px;
        position: relative;
        display: flex;
        flex-direction: column;
        align-self: stretch; /* å…³é”®ï¼šè®©ä¾§è¾¹æ ä¼¸å±•é«˜åº¦ */
    }
    
    /* æ–‡ç« ç›®å½•å›ºå®šæ ·å¼ - å…³é”®ä¿®å¤ */
    #article-toc {
        background: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #e1e1e1;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        position: sticky;
        top: 20px; /* ä»å¯¼èˆªæ ä¸‹æ–¹å¼€å§‹å›ºå®šï¼Œä¸å†…å®¹åŒºé—´è·ä¸€è‡´ */
        z-index: 100;
        max-height: calc(100vh - 40px); /* ä¸è¶…è¿‡å±å¹•é«˜åº¦ */
        overflow-y: auto;
        /* ç¡®ä¿stickyå®šä½ç”Ÿæ•ˆ */
        align-self: flex-start;
        flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
    }
    
    #article-toc h3 {
        margin: 0 0 12px 0;
        padding-bottom: 8px;
        border-bottom: 2px solid #3b82f6;
        color: #2d3748;
        font-size: 16px;
        font-weight: 600;
        position: sticky;
        top: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        z-index: 101;
        padding: 8px 0;
        margin-bottom: 8px;
    }
    
    #toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    #toc-list::-webkit-scrollbar {
        width: 4px;
    }
    
    #toc-list::-webkit-scrollbar-thumb {
        background: #cbd5e0;
        border-radius: 2px;
    }
    
    #toc-list li {
        margin: 4px 0;
        line-height: 1.4;
    }
    
    #toc-list a {
        display: block;
        padding: 6px 8px;
        color: #4a5568;
        text-decoration: none;
        border-radius: 4px;
        font-size: 14px;
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
    }
    
    #toc-list a:hover {
        background: #f7fafc;
        color: #3b82f6;
        border-left-color: #3b82f6;
    }
    
    /* æ›´ç²¾ç»†çš„å±‚çº§æ ·å¼ */
    .toc-level-2 {
        padding-left: 12px;
        font-weight: 600;
        font-size: 14px;
    }
    
    .toc-level-3 {
        padding-left: 24px;
        font-size: 13px;
        color: #4a5568;
        font-weight: 500;
    }
    
    .toc-level-4 {
        padding-left: 36px;
        font-size: 12px;
        color: #718096;
    }
    
    .toc-level-5 {
        padding-left: 48px;
        font-size: 12px;
        color: #a0aec0;
    }
    
    .toc-level-6 {
        padding-left: 60px;
        font-size: 11px;
        color: #cbd5e0;
    }
    
    .toc-active {
        background: #ebf8ff;
        color: #3b82f6;
        border-left-color: #3b82f6;
        font-weight: 500;
    }
    
    .toc-empty {
        color: #a0aec0;
        font-style: italic;
        text-align: center;
        padding: 20px;
    }

    /* ä¾§è¾¹æ å…¶ä»–å°éƒ¨ä»¶ - æ­£å¸¸æ»šåŠ¨ */
    .sidebar .widget {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid #e1e1e1;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        position: relative; /* æ­£å¸¸æ–‡æ¡£æµ */
    }

    /* ç§»åŠ¨ç«¯é€‚é… */
    @media (max-width: 768px) {
        .container.wrap {
            flex-direction: column;
        }
        
        .sidebar {
            width: 100%;
            margin-left: 0;
            margin-top: 20px;
        }
        
        #article-toc {
            position: relative;
            top: 0;
            margin-bottom: 15px;
            max-height: 300px;
        }
    }

    /* å¤‡é€‰æ–¹æ¡ˆï¼šJavaScriptå›ºå®šå®šä½ */
    #article-toc.fixed-toc {
        position: fixed;
        top: 20px;
        width: 280px;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
    }

    #article-toc-placeholder {
        display: none;
        height: 0;
    }

    #article-toc-placeholder.visible {
        display: block;
        height: auto;
    }
    </style>
    
    {{ &OPT.codeBeforHead }}
</head>
<body class="archive paged category category-zhishi category-5 paged-2 category-paged-2 lang-cn el-boxed">
    <!-- é¡µé¢å†…å®¹ä¿æŒä¸å˜ -->
    <header class="header">
        <div class="container clearfix">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar icon-bar-1"></span>
                    <span class="icon-bar icon-bar-2"></span>
                    <span class="icon-bar icon-bar-3"></span>
                </button>
                <div class="logo">
                    {{ #OPT.logo }}
                    <a href="/" rel="home"><img src="{{ &OPT.logo }}" alt="{{ &OPT.siteName }}"></a>
                    {{ /OPT.logo }}
                    
                    {{ ^OPT.logo }}
                    <a href="/" rel="home"><img src="https://cdn.jsdelivr.net/gh/chnbsdan/cloudflare-workers-blog@master/themes/JustNews2/files/logo2.png" alt="è¯·è‡ªå®šä¹‰OPT.logo"></a>
                    {{ /OPT.logo }}
                </div>
            </div>
            <div class="collapse navbar-collapse">
                <nav class="navbar-left primary-menu">
                    <ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav wpcom-adv-menu">
                        {{ #widgetMenuList }}
                            <li class="menu-item"><a href="{{ &url }}">{{ &title }}</a></li>
                        {{ /widgetMenuList }}
                    </ul>
                </nav>
                <div class="navbar-action pull-right">
                    <div id="j-user-wrap">
                        <a class="login cur" href="/admin">ç™»å½•</a>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <div id="wrap">
        <div class="container wrap">
            <div class="main">
                <article id="post-{{ &articleSingle.id }}" class="post-{{ &articleSingle.id }} post type-post status-publish format-standard has-post-thumbnail hentry ">
                    <div class="entry">
                        <div class="entry-head">
                            <h1 class="entry-title">{{ &articleSingle.title }}</h1>
                            <div class="entry-info">
                                <time class="entry-date published" datetime="{{ &articleSingle.createDate }}" pubdate="">{{ &articleSingle.createDate10 }}</time>
                                <span class="dot">â€¢</span>
                                {{ #articleSingle.category }}
                                    <a href="/category/{{&.}}" rel="category tag">{{&.}}</a>
                                {{ /articleSingle.category }}
                                <span class="dot">â€¢</span>
                                <span class="leancloud_visitors">
                                    <em>{{ &OPT.otherCodeA }}</em>
                                    <span class="waline-pageview-count" data-path="{{ &articleSingle.url }}" />
                                </span>
                            </div>
                        </div>
                        <div class="entry-content">
                            {{ &articleSingle.contentHtml }}
                        </div>
                        <div class="entry-footer">
                            <div class="entry-tag">
                                {{ #articleSingle.tags }}
                                    <a href="/tags/{{&.}}" rel="tag">{{&.}}</a>
                                {{ /articleSingle.tags }}
                            </div>

                            <div class="entry-page">

                                {{ #articleNewer }}	
                                <div class="entry-page-prev j-lazy lazyloaded" style="background-image: url(&quot;{{ &img }}&quot;); display: block;" data-original="{{ &img }}" data-bg="{{ &img }}" fifu-width="392" fifu-height="86">
                                    <a href="{{ &url }}" title="{{ &title }}" rel="prev" >
                                        <span>{{ &title }}</span></a>
                                    <div class="entry-page-info">
                                        <span class="pull-left">
                                            <i class="wpcom-icon wi">
                                                <svg aria-hidden="true">
                                                    <use xlink:href="#wi-arrow-left-double"></use>
                                                </svg>
                                            </i>ä¸Šä¸€ç¯‡</span>
                                        <span class="pull-right">{{ &createDate10 }}</span></div>
                                </div>
                                {{ /articleNewer }}

                                {{ #articleOlder }}
                                <div class="entry-page-next j-lazy lazyloaded" style="background-image: url(&quot;{{ &img }}&quot;); display: block;" data-original="{{ &img }}" data-bg="{{ &img }}" fifu-width="392" fifu-height="86">
                                    <a href="{{ &url }}" title="{{ &title }}" rel="next" >
                                        <span>{{ &title }}</span></a>
                                    <div class="entry-page-info">
                                        <span class="pull-right">ä¸‹ä¸€ç¯‡
                                            <i class="wpcom-icon wi">
                                                <svg aria-hidden="true">
                                                    <use xlink:href="#wi-arrow-right-double"></use></svg>
                                            </i>
                                        </span>
                                        <span class="pull-left">{{ &createDate10 }}</span></div>
                                </div>
                                {{ /articleOlder }}
                            </div>
                        </div>
                        <div id="comments" class="entry-comments">
                            {{ &OPT.commentCode }}
                        </div>
                    </div>
                </article>
            </div>

            <aside class="sidebar">
                <!-- æ–‡ç« ç›®å½• - ç°åœ¨åº”è¯¥æ­£ç¡®å›ºå®šäº† -->
                <div id="article-toc">
                    <h3>ğŸ“‘ æ–‡ç« ç›®å½•</h3>
                    <ul id="toc-list">
                        <li class="toc-empty">æ­£åœ¨ç”Ÿæˆç›®å½•...</li>
                    </ul>
                </div>

                <!-- å…¶ä»–å°éƒ¨ä»¶ - æ­£å¸¸æ»šåŠ¨ -->
                <div id="wpcom-post-thumb-2" class="widget widget_post_thumb">
                    <h3 class="widget-title">
                        <span>è¿‘æœŸæ–‡ç« </span></h3>
                    <ul>
                        {{ #widgetRecentlyList }}
                        <li class="item">
                            <div class="item-img">
                                <a class="item-img-inner" href="{{ &url }}" title="{{ &title }}">
                                    <img width="480" height="264" src="{{ &img }}" class="attachment-post-thumbnail size-post-thumbnail wp-post-image j-lazy" alt="" title="" data-original="{{ &img }}" /></a>
                            </div>
                            <div class="item-content">
                                <p class="item-title">
                                    <a href="{{ &url }}" title="{{ &title }}">{{ &title }}</a></p>
                                <p class="item-date">{{ &createDate10 }}</p></div>
                        </li>
                        {{ /widgetRecentlyList }}									
                    </ul>
                </div>
                <div id="categories-3" class="widget widget_categories">
                    <h3 class="widget-title">
                        <span>åˆ†ç±»ç›®å½•</span></h3>
                    <ul>
                        {{ #widgetCategoryList }}
                        <li class="cat-item cat-item-5 current-cat">
                            <a aria-current="page" href="/category/{{&.}}">{{&.}}</a></li>
                        {{ /widgetCategoryList }}
                    </ul>
                </div>
                <div id="tag_cloud-3" class="widget widget_tag_cloud">
                    <h3 class="widget-title">
                        <span>æ ‡ç­¾</span></h3>
                    <div class="tagcloud">
                        {{ #widgetTagsList }}
                        <a href="/tags/{{&.}}" class="tag-cloud-link tag-link-6 tag-link-position-1" style="font-size: 8pt;" aria-label="{{&.}}">{{&.}}</a>
                        {{ /widgetTagsList }}
                    </div>
                </div>

                <div id="linkcat-0" class="widget widget_links">
                    <h3 class="widget-title">
                        <span>é“¾æ¥</span></h3>
                    <div class="link-tagcloud">
                        {{ #widgetLinkList }}
                            <a href="{{ &url }}" target="_blank" class="link-tag">{{ &title }}</a>
                        {{ /widgetLinkList }}
                    </div>
                </div>
                
                {{ #OPT.widgetOther }}
                <div class="widget_other">
                    {{ &OPT.widgetOther }}
                </div>
                {{ /OPT.widgetOther }}
            </aside>
        </div>
    </div>

    <!-- ä¿æŒä¹‹å‰çš„ç²¾ç»†ç›®å½•ç”Ÿæˆè„šæœ¬ -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // ç”Ÿæˆæ›´ç²¾ç»†çš„æ–‡ç« ç›®å½•
        function generateTOC() {
            const articleContent = document.querySelector('.entry-content');
            const tocList = document.getElementById('toc-list');
            
            if (!articleContent || !tocList) {
                console.log('æœªæ‰¾åˆ°æ–‡ç« å†…å®¹æˆ–ç›®å½•å®¹å™¨');
                return;
            }
            
            // æ¸…ç©ºç°æœ‰å†…å®¹
            tocList.innerHTML = '';
            
            // è·å–æ‰€æœ‰æ ‡é¢˜å…ƒç´ 
            const headings = articleContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
            console.log('æ‰¾åˆ°æ ‡é¢˜æ•°é‡:', headings.length);
            
            if (headings.length === 0) {
                tocList.innerHTML = '<li class="toc-empty">æœ¬æ–‡æš‚æ— ç›®å½•ç»“æ„</li>';
                return;
            }
            
            // è¿‡æ»¤æœ‰æ•ˆçš„æ ‡é¢˜ï¼ˆæœ‰å®é™…å†…å®¹çš„ï¼‰
            const validHeadings = Array.from(headings).filter(heading => {
                const text = heading.textContent.trim();
                return text.length > 0 && 
                       !heading.classList.contains('entry-title') && // æ’é™¤æ–‡ç« æ ‡é¢˜
                       !heading.closest('.widget') && // æ’é™¤å°éƒ¨ä»¶ä¸­çš„æ ‡é¢˜
                       !heading.closest('.comments-area'); // æ’é™¤è¯„è®ºåŒºçš„æ ‡é¢˜
            });
            
            console.log('æœ‰æ•ˆæ ‡é¢˜æ•°é‡:', validHeadings.length);
            
            if (validHeadings.length === 0) {
                tocList.innerHTML = '<li class="toc-empty">æœ¬æ–‡æš‚æ— æœ‰æ•ˆçš„ç›®å½•ç»“æ„</li>';
                return;
            }
            
            let tocHTML = '';
            let previousLevel = 1;
            
            validHeadings.forEach((heading, index) => {
                // è·å–æ ‡é¢˜çº§åˆ«
                const level = parseInt(heading.tagName.substring(1));
                
                // ç”Ÿæˆæ›´å‹å¥½çš„ID
                let headingId = heading.id;
                if (!headingId || headingId.startsWith('heading-')) {
                    // åŸºäºæ ‡é¢˜æ–‡æœ¬ç”ŸæˆID
                    const text = heading.textContent.trim();
                    headingId = 'toc-' + text
                        .toLowerCase()
                        .replace(/[^a-z0-9\u4e00-\u9fa5]/g, '-')
                        .replace(/-+/g, '-')
                        .replace(/^-|-$/g, '') + '-' + index;
                    heading.id = headingId;
                }
                
                // ç¡®ä¿IDå”¯ä¸€
                let uniqueId = headingId;
                let counter = 1;
                while (document.getElementById(uniqueId) && document.getElementById(uniqueId) !== heading) {
                    uniqueId = headingId + '-' + counter;
                    counter++;
                }
                if (uniqueId !== headingId) {
                    heading.id = uniqueId;
                }
                
                // å¤„ç†å±‚çº§å…³ç³»
                const levelClass = 'toc-level-' + level;
                
                // æ„å»ºç›®å½•é¡¹
                tocHTML += `
                    <li class="${levelClass}">
                        <a href="#${heading.id}" data-level="${level}" title="${heading.textContent.trim()}">
                            ${heading.textContent.trim()}
                        </a>
                    </li>
                `;
                
                previousLevel = level;
            });
            
            tocList.innerHTML = tocHTML;
            console.log('ç›®å½•ç”Ÿæˆå®Œæˆï¼Œå…±', validHeadings.length, 'ä¸ªé¡¹ç›®');
            
            // æ·»åŠ æ»šåŠ¨ç›‘å¬
            initScrollSpy(validHeadings);
        }
        
        // åˆå§‹åŒ–æ»šåŠ¨ç›‘å¬
        function initScrollSpy(headings) {
            const tocLinks = document.querySelectorAll('#toc-list a');
            
            if (tocLinks.length === 0) return;
            
            // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
            function removeActiveClasses() {
                tocLinks.forEach(link => {
                    link.classList.remove('toc-active');
                });
            }
            
            // ç›‘å¬æ»šåŠ¨
            let scrollTimeout;
            window.addEventListener('scroll', function() {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    let current = '';
                    let closestDistance = Infinity;
                    
                    // æ‰¾åˆ°è·ç¦»é¡¶éƒ¨æœ€è¿‘çš„æ ‡é¢˜
                    headings.forEach(heading => {
                        const rect = heading.getBoundingClientRect();
                        const distance = Math.abs(rect.top - 100); // 100pxåç§»é‡
                        
                        if (rect.top <= 150 && distance < closestDistance) {
                            closestDistance = distance;
                            current = heading.id;
                        }
                    });
                    
                    removeActiveClasses();
                    
                    if (current) {
                        const activeLink = document.querySelector(`#toc-list a[href="#${current}"]`);
                        if (activeLink) {
                            activeLink.classList.add('toc-active');
                            
                            // æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ
                            const tocList = document.getElementById('toc-list');
                            const activeLinkTop = activeLink.offsetTop;
                            const tocListHeight = tocList.clientHeight;
                            
                            if (activeLinkTop > tocList.scrollTop + tocListHeight - 50) {
                                tocList.scrollTop = activeLinkTop - tocListHeight + 50;
                            } else if (activeLinkTop < tocList.scrollTop) {
                                tocList.scrollTop = activeLinkTop - 20;
                            }
                        }
                    }
                }, 10);
            });
            
            // åˆå§‹æ¿€æ´»ç¬¬ä¸€ä¸ª
            if (headings.length > 0) {
                const firstLink = document.querySelector(`#toc-list a[href="#${headings[0].id}"]`);
                if (firstLink) {
                    firstLink.classList.add('toc-active');
                }
            }
        }
        
        // å¹³æ»‘æ»šåŠ¨
        document.querySelectorAll('#toc-list a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href').substring(1);
                const targetElement = document.getElementById(targetId);
                
                if (targetElement) {
                    const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 80;
                    window.scrollTo({
                        top: offsetTop,
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // å»¶è¿Ÿç”Ÿæˆç›®å½•ï¼Œç¡®ä¿å†…å®¹å·²åŠ è½½
        setTimeout(generateTOC, 300);
        
        // è°ƒè¯•stickyå®šä½
        function debugStickyPosition() {
            const toc = document.getElementById('article-toc');
            const sidebar = document.querySelector('.sidebar');
            const wrap = document.querySelector('.container.wrap');
            
            if (toc) {
                console.log('TOCä½ç½®ä¿¡æ¯:');
                console.log('- position:', getComputedStyle(toc).position);
                console.log('- top:', getComputedStyle(toc).top);
                console.log('- çˆ¶å…ƒç´ é«˜åº¦:', sidebar.offsetHeight);
                console.log('- å®¹å™¨é«˜åº¦:', wrap.offsetHeight);
                console.log('- è§†å£é«˜åº¦:', window.innerHeight);
                
                // æ£€æŸ¥æ˜¯å¦åœ¨stickyå®šä½èŒƒå›´å†…
                const rect = toc.getBoundingClientRect();
                console.log('- è·ç¦»é¡¶éƒ¨:', rect.top);
            }
        }
        
        // å¤‡é€‰æ–¹æ¡ˆï¼šJavaScriptå›ºå®šå®šä½
        function initTocFixed() {
            const toc = document.getElementById('article-toc');
            const sidebar = document.querySelector('.sidebar');
            
            // å¦‚æœstickyå®šä½ä¸ç”Ÿæ•ˆï¼Œä½¿ç”¨JavaScriptå¤‡é€‰æ–¹æ¡ˆ
            function checkStickySupport() {
                const tocStyle = getComputedStyle(toc);
                return tocStyle.position === 'sticky';
            }
            
            if (!checkStickySupport()) {
                console.log('stickyå®šä½ä¸æ”¯æŒï¼Œå¯ç”¨JavaScriptå¤‡é€‰æ–¹æ¡ˆ');
                
                const placeholder = document.createElement('div');
                placeholder.id = 'article-toc-placeholder';
                sidebar.insertBefore(placeholder, toc);
                
                function updateTocPosition() {
                    const sidebarRect = sidebar.getBoundingClientRect();
                    const wrapRect = document.querySelector('.container.wrap').getBoundingClientRect();
                    
                    // å½“ä¾§è¾¹æ è¿›å…¥è§†å£æ—¶å›ºå®šç›®å½•
                    if (sidebarRect.top <= 20 && sidebarRect.bottom >= window.innerHeight) {
                        toc.classList.add('fixed-toc');
                        placeholder.classList.add('visible');
                        placeholder.style.height = toc.offsetHeight + 'px';
                    } else {
                        toc.classList.remove('fixed-toc');
                        placeholder.classList.remove('visible');
                    }
                }
                
                window.addEventListener('scroll', updateTocPosition);
                window.addEventListener('resize', updateTocPosition);
                updateTocPosition();
            } else {
                console.log('stickyå®šä½å·²å¯ç”¨');
            }
        }
        
        // åˆå§‹åŒ–ç›®å½•å›ºå®š
        setTimeout(initTocFixed, 500);
        
        // è°ƒè¯•ä¿¡æ¯
        setTimeout(debugStickyPosition, 1000);
    });
    </script>
    
    {{ &OPT.codeBeforBody }}
</body>
</html>
