<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width,viewport-fit=cover">
		<title>{{ &articleSingle.title }} - {{ &OPT.siteName }}</title>
		<meta name="keywords" content="{{ &keyWords }}" />
		<meta name="description" content="{{ &OPT.siteDescription }}" />

		<link rel='stylesheet' id='stylesheet-css' href='https://cdn.jsdelivr.net/gh/gdtool/cloudflare-workers-blog@master/themes/JustNews/files/main.css' type='text/css' media='all' />
		<link rel='stylesheet' id='font-awesome-css' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css' type='text/css' media='all' />
		<link rel='stylesheet' id='wp-block-library-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/block-library/style.min.css?ver=5.6' type='text/css' media='all' />
		<link rel='stylesheet' id='wp-components-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/components/style.min.css?ver=5.6' type='text/css' media='all' />
		<link rel='stylesheet' id='wp-editor-font-css' href='https://fonts.geekzu.org/css?family=Noto+Serif%3A400%2C400i%2C700%2C700i&#038;ver=5.6' type='text/css' media='all' />
		<link rel='stylesheet' id='wp-block-editor-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/block-editor/style.min.css?ver=5.6' type='text/css' media='all' />
		<link rel='stylesheet' id='wp-nux-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/nux/style.min.css?ver=5.6' type='text/css' media='all' />
		<link rel='stylesheet' id='wp-editor-css' href='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.5.3/wp-includes/css/dist/editor/style.min.css?ver=5.6' type='text/css' media='all' />
		<link rel='stylesheet' id='mux_video_block_style-css' href='https://cdn.jsdelivr.net/gh/newexsexy/wp@master/wp-content/plugins/ilab-media-tools/public/blocks/mediacloud-mux.blocks.style.min.css' type='text/css' media='all' />
		
		<link rel='stylesheet' id='emojify-css' href='https://cdn.jsdelivr.net/npm/emojify.js@1.1.0/dist/css/basic/emojify.min.css?ver=1.1.0' type='text/css' media='all' />
		<script type='text/javascript' src='https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js?ver=3.5.1' id='jquery-core-js'></script>
		<script type='text/javascript' src='https://cdn.jsdelivr.net/gh/WordPress/WordPress@5.6/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
		<script type='text/javascript' src='https://cdn.jsdelivr.net/gh/wpcom-cn/assets/fonts/icons-2.6.4.js?ver=6.1.2' id='wpcom-icons-js'></script>
		<link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.3.2/styles/tomorrow-night-bright.min.css">
		<script src='https://cdn.staticfile.org/highlight.js/10.3.2/highlight.min.js'></script>

		<style>
		/* ä¿®æ”¹æ–‡ç« ç›®å½•å®¹å™¨å®šä½å’Œå¸ƒå±€ */
		.toc-container {
			position: sticky;
			top: 20px;
			width: 100%;
			z-index: 99;
			background: white;
			padding: 1rem;
			border-radius: 0.75rem;
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
			transition: all 0.3s ease;
			display: block;
			max-height: 400px;
			overflow: hidden;
			margin-bottom: 20px;
			order: -1;
		}

		/* ä¾§è¾¹æ å¸ƒå±€è°ƒæ•´ */
		.sidebar {
			position: relative;
			display: flex;
			flex-direction: column;
		}

		/* ç¡®ä¿æ–‡ç« ç›®å½•åœ¨ä¾§è¾¹æ ä¸­æ’åœ¨æœ€å‰é¢ */
		.sidebar .toc-container {
			order: -1;
		}

		/* å…¶ä»–å°éƒ¨ä»¶å®¹å™¨æ·»åŠ æ»šåŠ¨æ•ˆæœ */
		.sidebar > *:not(.toc-container) {
			transition: transform 0.3s ease;
		}

		/* æµ®åŠ¨ç›®å½•æŒ‰é’® - æ‰€æœ‰è®¾å¤‡éƒ½æ˜¾ç¤º */
		#toc-float-btn {
			position: fixed;
			right: 30px;
			bottom: 20px;
			width: 50px;
			height: 50px;
			background: #3b82f6;
			color: white;
			border: none;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			z-index: 10000;
			box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
			transition: all 0.3s ease;
			font-size: 18px;
		}

		#toc-float-btn:hover {
			background: #2563eb;
			transform: scale(1.1);
			box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
		}

		/* æ–‡ç« ç›®å½•å®¹å™¨ - æµ®åŠ¨é¢æ¿ */
		#article-toc-floating {
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 90vw;
			max-width: 400px;
			max-height: 70vh;
			background: white;
			border: 1px solid #e1e1e1;
			border-radius: 12px;
			box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
			z-index: 10001;
			display: none;
			overflow: hidden;
		}

		#article-toc-floating.show {
			display: block;
		}

		/* ç›®å½•é®ç½© */
		#toc-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.4);
			z-index: 10000;
			display: none;
		}

		#toc-overlay.show {
			display: block;
		}

		/* ç›®å½•å¤´éƒ¨ */
		.toc-floating-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 16px 20px;
			background: linear-gradient(135deg, #3b82f6, #1d4ed8);
			color: white;
			border-radius: 12px 12px 0 0;
		}

		.toc-floating-header h3 {
			margin: 0;
			font-size: 16px;
			font-weight: 600;
		}

		.toc-close-btn {
			background: none;
			border: none;
			color: white;
			font-size: 16px;
			cursor: pointer;
			width: 28px;
			height: 28px;
			border-radius: 6px;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background 0.3s ease;
		}

		.toc-close-btn:hover {
			background: rgba(255, 255, 255, 0.2);
		}

		/* ç›®å½•å†…å®¹ */
		#toc-floating-list {
			list-style: none;
			padding: 15px;
			margin: 0;
			max-height: calc(70vh - 60px);
			overflow-y: auto;
		}

		#toc-floating-list::-webkit-scrollbar {
			width: 4px;
		}

		#toc-floating-list::-webkit-scrollbar-thumb {
			background: #cbd5e0;
			border-radius: 2px;
		}

		#toc-floating-list li {
			margin: 3px 0;
			line-height: 1.4;
		}

		#toc-floating-list a {
			display: block;
			padding: 8px 12px;
			color: #4a5568;
			text-decoration: none;
			border-radius: 6px;
			font-size: 14px;
			transition: all 0.2s ease;
			border-left: 3px solid transparent;
		}

		#toc-floating-list a:hover {
			background: #f7fafc;
			color: #3b82f6;
			border-left-color: #3b82f6;
		}

		/* ç²¾ç»†çš„æ ‡é¢˜çº§åˆ«æ ·å¼ */
		#toc-floating-list .toc-h1 {
			padding-left: 12px;
			font-weight: 700;
			font-size: 15px;
			color: #1a202c;
			border-left-color: #3b82f6;
		}

		#toc-floating-list .toc-h2 {
			padding-left: 20px;
			font-weight: 600;
			font-size: 14px;
			color: #2d3748;
			border-left-color: #60a5fa;
		}

		#toc-floating-list .toc-h3 {
			padding-left: 28px;
			font-weight: 500;
			font-size: 14px;
			color: #4a5568;
			border-left-color: #93c5fd;
		}

		#toc-floating-list .toc-h4 {
			padding-left: 36px;
			font-size: 13px;
			color: #718096;
			border-left-color: #bfdbfe;
		}

		#toc-floating-list .toc-h5 {
			padding-left: 44px;
			font-size: 13px;
			color: #a0aec0;
			border-left-color: #dbeafe;
		}

		#toc-floating-list .toc-h6 {
			padding-left: 52px;
			font-size: 12px;
			color: #cbd5e0;
			border-left-color: #eff6ff;
		}

		#toc-floating-list .toc-active {
			background: #ebf8ff !important;
			color: #3b82f6 !important;
			font-weight: 600 !important;
			border-left-color: #3b82f6 !important;
		}

		.toc-empty {
			color: #a0aec0;
			font-style: italic;
			text-align: center;
			padding: 40px 20px;
			font-size: 14px;
		}

		.toc-container h2 {
			display: inline-flex;
			align-items: center;
			gap: 0.5rem;
			font-size: 1rem;
			font-weight: 600;
			color: #1f2937;
			margin: 0 0 0.5rem 0;
		}

		.toc-container .toc {
			max-height: 350px;
			overflow-y: auto;
		}

		.toc-container .toc::-webkit-scrollbar {
			width: 4px;
		}

		.toc-container .toc::-webkit-scrollbar-thumb {
			background: #d1d5db;
			border-radius: 2px;
		}

		/* ä¿®å¤ç›®å½•é“¾æ¥æ ·å¼ */
		.toc-container .toc a {
			display: block;
			padding: 6px 12px;
			color: #4b5563;
			text-decoration: none;
			border-radius: 4px;
			font-size: 14px;
			transition: all 0.2s ease;
			border-left: 3px solid transparent;
			margin: 2px 0;
		}

		.toc-container .toc a:hover {
			background: #f3f4f6;
			color: #3b82f6;
			border-left-color: #3b82f6;
		}

		.toc-container .toc a.active {
			background: #ebf8ff;
			color: #3b82f6;
			border-left-color: #3b82f6;
			font-weight: 600;
		}

		/* ç›®å½•å±‚çº§ç¼©è¿› */
		.toc-level-1 a { padding-left: 12px; }
		.toc-level-2 a { padding-left: 20px; }
		.toc-level-3 a { padding-left: 28px; }
		.toc-level-4 a { padding-left: 36px; }
		.toc-level-5 a { padding-left: 44px; }
		.toc-level-6 a { padding-left: 52px; }

		/* å“åº”å¼å¸ƒå±€è°ƒæ•´ */
		@media (min-width: 1200px) {
			/* æ¡Œé¢ç«¯æ˜¾ç¤ºå›ºå®šç›®å½• */
			.toc-container {
				display: block;
			}
			
			/* æ¡Œé¢ç«¯ä¹Ÿæ˜¾ç¤ºæµ®åŠ¨æŒ‰é’®ï¼Œä½†ä½ç½®è°ƒæ•´ */
			#toc-float-btn {
				display: flex;
				bottom: 120px;
			}
		}

		@media (max-width: 1199px) {
			/* ç§»åŠ¨ç«¯éšè—å›ºå®šç›®å½• */
			.toc-container {
				display: none;
			}
			
			/* ç§»åŠ¨ç«¯æ˜¾ç¤ºæµ®åŠ¨æŒ‰é’® */
			#toc-float-btn {
				display: flex;
				bottom: 100px;
			}
		}

		/* æš—è‰²æ¨¡å¼æ”¯æŒ */
		@media (prefers-color-scheme: dark) {
			.toc-container {
				background: #1e293b;
				color: #f1f5f9;
			}

			.toc-container h2 {
				color: #f1f5f9;
			}

			.toc-container .toc a {
				color: #d1d5db;
			}

			.toc-container .toc a:hover {
				background: #374151;
				color: #60a5fa;
			}

			.toc-container .toc a.active {
				background: #1e40af;
				color: #dbeafe;
			}

			#article-toc-floating {
				background: #1e293b;
				color: #f1f5f9;
			}

			#toc-floating-list a {
				color: #d1d5db;
			}

			#toc-floating-list a:hover {
				background: #374151;
				color: #60a5fa;
			}
		}
		</style>
		
		{{ &OPT.codeBeforHead }}
	</head>
	<body class="archive paged category category-zhishi category-5 paged-2 category-paged-2 lang-cn el-boxed">
		<header class="header">
			<div class="container clearfix">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
						<span class="icon-bar icon-bar-1"></span>
						<span class="icon-bar icon-bar-2"></span>
						<span class="icon-bar icon-bar-3"></span>
					</button>
					<div class="logo">
						{{ #OPT.logo }}
						<a href="/" rel="home"><img src="{{ &OPT.logo }}" alt="{{ &OPT.siteName }}"></a>
						{{ /OPT.logo }}
						
						{{ ^OPT.logo }}
						<a href="/" rel="home"><img src="https://cdn.jsdelivr.net/gh/chnbsdan/cloudflare-workers-blog@master/themes/JustNews2/files/logo2.png" alt="è¯·è‡ªå®šä¹‰OPT.logo"></a>
						{{ /OPT.logo }}
					</div>
				</div>
				<div class="collapse navbar-collapse">
					<nav class="navbar-left primary-menu">
						<ul id="menu-%e5%af%bc%e8%88%aa" class="nav navbar-nav wpcom-adv-menu">
							{{ #widgetMenuList }}
								<li class="menu-item"><a href="{{ &url }}">{{ &title }}</a></li>
							{{ /widgetMenuList }}
						</ul>
					</nav>
					<div class="navbar-action pull-right">
						<div id="j-user-wrap">
							<a class="login cur" href="/admin">ç™»å½•</a>
						</div>
					</div>
				</div>
			</div>
		</header>
		
		<div id="wrap">
			<div class="container wrap">
				<div class="main">
					<article id="post-{{ &articleSingle.id }}" class="post-{{ &articleSingle.id }} post type-post status-publish format-standard has-post-thumbnail hentry ">
						<div class="entry">
							<div class="entry-head">
								<h1 class="entry-title">{{ &articleSingle.title }}</h1>
								<div class="entry-info">
									<time class="entry-date published" datetime="{{ &articleSingle.createDate }}" pubdate="">{{ &articleSingle.createDate10 }}</time>
									<span class="dot">â€¢</span>
									{{ #articleSingle.category }}
										<a href="/category/{{&.}}" rel="category tag">{{&.}}</a>
									{{ /articleSingle.category }}
									<span class="dot">â€¢</span>
									<span id="{{ &articleSingle.url }}" class="leancloud_visitors">
										<em>{{ &OPT.otherCodeA }}</em>
										<i class="leancloud-visitors-count"></i>
									</span>
								</div>
							</div>
							<div class="entry-content">
								{{{ articleSingle.contentHtml }}}
							</div>
							<div class="entry-footer">
								<div class="entry-tag">
									{{ #articleSingle.tags }}
										<a href="/tags/{{&.}}" rel="tag">{{&.}}</a>
									{{ /articleSingle.tags }}
								</div>

								<div class="entry-page">
									{{ #articleNewer }}	
									<div class="entry-page-prev j-lazy lazyloaded" style="background-image: url(&quot;{{ &img }}&quot;); display: block;" data-original="{{ &img }}" data-bg="{{ &img }}" fifu-width="392" fifu-height="86">
										<a href="{{ &url }}" title="{{ &title }}" rel="prev" >
											<span>{{ &title }}</span></a>
										<div class="entry-page-info">
											<span class="pull-left">
												<i class="wpcom-icon wi">
													<svg aria-hidden="true">
														<use xlink:href="#wi-arrow-left-double"></use>
													</svg>
												</i>ä¸Šä¸€ç¯‡</span>
											<span class="pull-right">{{ &createDate10 }}</span></div>
									</div>
									{{ /articleNewer }}

									{{ #articleOlder }}
									<div class="entry-page-next j-lazy lazyloaded" style="background-image: url(&quot;{{ &img }}&quot;); display: block;" data-original="{{ &img }}" data-bg="{{ &img }}" fifu-width="392" fifu-height="86">
										<a href="{{ &url }}" title="{{ &title }}" rel="next" >
											<span>{{ &title }}</span></a>
										<div class="entry-page-info">
											<span class="pull-right">ä¸‹ä¸€ç¯‡
												<i class="wpcom-icon wi">
													<svg aria-hidden="true">
														<use xlink:href="#wi-arrow-right-double"></use></svg>
												</i>
											</span>
											<span class="pull-left">{{ &createDate10 }}</span></div>
									</div>
									{{ /articleOlder }}
								</div>
							</div>
							<div id="comments" class="entry-comments">
								{{ &OPT.commentCode }}
							</div>
						</div>
					</article>
				</div>

				<aside class="sidebar">
					<!-- æ–‡ç« ç›®å½•ç°åœ¨åœ¨ä¾§è¾¹æ æœ€å‰é¢ -->
					<div class="toc-container">
						<h2>
							<i class="fas fa-list"></i>
							ç›®å½•
						</h2>
						<div class="toc"></div>
					</div>

					<!-- åŸæœ‰ä¾§è¾¹æ å°éƒ¨ä»¶ä¿æŒä¸å˜ï¼Œä½†åœ¨æ–‡ç« ç›®å½•ä¸‹æ–¹ -->
					<div id="wpcom-post-thumb-2" class="widget widget_post_thumb">
						<h3 class="widget-title">
							<span>è¿‘æœŸæ–‡ç« </span></h3>
						<ul>
							{{ #widgetRecentlyList }}
							<li class="item">
								<div class="item-img">
									<a class="item-img-inner" href="{{ &url }}" title="{{ &title }}">
										<img width="480" height="264" src="{{ &img }}" class="attachment-post-thumbnail size-post-thumbnail wp-post-image j-lazy" alt="" title="" data-original="{{ &img }}" /></a>
								</div>
								<div class="item-content">
									<p class="item-title">
										<a href="{{ &url }}" title="{{ &title }}">{{ &title }}</a></p>
									<p class="item-date">{{ &createDate10 }}</p></div>
							</li>
							{{ /widgetRecentlyList }}									
						</ul>
					</div>
					<div id="categories-3" class="widget widget_categories">
						<h3 class="widget-title">
							<span>åˆ†ç±»ç›®å½•</span></h3>
						<div class="link-tagcloud">
							{{ #widgetCategoryList }}
							<a href="/category/{{&.}}" class="link-tag">{{&.}}</a>
							{{ /widgetCategoryList }}
						</div>
					</div>
					<div id="tag_cloud-3" class="widget widget_tag_cloud">
						<h3 class="widget-title">
							<span>æ ‡ç­¾</span></h3>
						<div class="tagcloud">
							{{ #widgetTagsList }}
							<a href="/tags/{{&.}}" class="tag-cloud-link tag-link-6 tag-link-position-1" style="font-size: 8pt;" aria-label="{{&.}}">{{&.}}</a>
							{{ /widgetTagsList }}
						</div>
					</div>
					<div id="linkcat-0" class="widget widget_links">
						<h3 class="widget-title">
							<span>é“¾æ¥</span></h3>
						<div class="link-tagcloud">
							{{ #widgetLinkList }}
								<a href="{{ &url }}" target="_blank" class="link-tag">{{ &title }}</a>
							{{ /widgetLinkList }}
						</div>
					</div>
					{{ &OPT.widgetOther }}
				</aside>
			</div>
		</div>

		<!-- æµ®åŠ¨ç›®å½•æŒ‰é’® -->
		<button id="toc-float-btn" title="æ‰“å¼€æ–‡ç« ç›®å½•">
			<i class="fas fa-list"></i>
		</button>

		<!-- æµ®åŠ¨ç›®å½•å®¹å™¨ -->
		<div id="toc-overlay"></div>
		<div id="article-toc-floating">
			<div class="toc-floating-header">
				<h3>ğŸ“‘ æ–‡ç« ç›®å½•</h3>
				<button class="toc-close-btn" title="å…³é—­ç›®å½•">
					<i class="fas fa-times"></i>
				</button>
			</div>
			<ul id="toc-floating-list">
				<li class="toc-empty">æ­£åœ¨ç”Ÿæˆç›®å½•...</li>
			</ul>
		</div>

		<div class="social-icons-bar">
			<a href="mailto:kekelove1688@gmail.com" class="social-icon" title="é‚®ç®±">
				<i class="fas fa-envelope"></i>
			</a>
			<a href="https://weibo.com/u/7866257468" class="social-icon" target="_blank" title="å¾®åš">
				<i class="fab fa-weibo"></i>
			</a>
			<a href="https://www.facebook.com/profile.php?id=100091963634555" class="social-icon" target="_blank" title="Facebook">
				<i class="fab fa-facebook-f"></i>
			</a>
			<a href="#" class="social-icon back-to-top" onclick="scrollToTop(); return false;" title="è¿”å›é¡¶éƒ¨">
				<i class="fas fa-chevron-up"></i>
			</a>
			<a href="https://x.com/home/@chnbsdan" class="social-icon" target="_blank" title="Xå¸å·">
				<i class="fab fa-twitter"></i>
			</a>
			<a href="https://space.bilibili.com/1913680621" class="social-icon" target="_blank" title="Bilibili">
				<i class="fab fa-bilibili"></i>
			</a>
			<a href="https://t.me/ben_mesa" class="social-icon" target="_blank" title="Telegram">
				<i class="fab fa-telegram-plane"></i>
			</a>
		</div>
		
		<footer class="footer">
			<div class="container">
				<div class="clearfix">
					<div class="footer-col footer-col-copy">
						<div class="copyright">
							<p>{{ &OPT.copyRight }}</p>
						</div>
					</div>
					<div class="footer-col footer-col-sns">
						<div class="footer-sns"></div>
					</div>
				</div>
			</div>
		</footer>
		<div class="action action-style-0 action-color-0 action-pos-0" style="bottom:20%;">
			<div class="action-item gotop j-top">
				<i class="wpcom-icon wi action-item-icon">
					<svg aria-hidden="true">
						<use xlink:href="#wi-arrow-up-2"></use>
					</svg>
				</i>
			</div>
		</div>

		<script>
		document.addEventListener('DOMContentLoaded', function() {
			// æµ®åŠ¨ç›®å½•åŠŸèƒ½
			const tocFloatBtn = document.getElementById('toc-float-btn');
			const tocFloating = document.getElementById('article-toc-floating');
			const tocOverlay = document.getElementById('toc-overlay');
			const tocCloseBtn = document.querySelector('.toc-close-btn');
			let isTocGenerated = false;

			function initFloatingToc() {
				tocFloatBtn.addEventListener('click', openToc);
				tocOverlay.addEventListener('click', closeToc);
				tocCloseBtn.addEventListener('click', closeToc);

				document.addEventListener('keydown', function(e) {
					if (e.key === 'Escape' && tocFloating.classList.contains('show')) {
						closeToc();
					}
				});
			}

			function openToc() {
				tocFloating.classList.add('show');
				tocOverlay.classList.add('show');
				document.body.style.overflow = 'hidden';

				if (!isTocGenerated) {
					generateFloatingTOC();
					isTocGenerated = true;
				}
			}

			function closeToc() {
				tocFloating.classList.remove('show');
				tocOverlay.classList.remove('show');
				document.body.style.overflow = '';
			}

			function generateFloatingTOC() {
				const articleContent = document.querySelector('.entry-content');
				const tocList = document.getElementById('toc-floating-list');

				if (!articleContent || !tocList) return;

				tocList.innerHTML = '';
				const headings = articleContent.querySelectorAll('h1, h2, h3, h4, h5, h6');

				if (headings.length === 0) {
					tocList.innerHTML = '<li class="toc-empty">æœ¬æ–‡æš‚æ— ç›®å½•ç»“æ„</li>';
					return;
				}

				let tocHTML = '';
				headings.forEach((heading, index) => {
					let headingId = heading.id;
					if (!headingId) {
						headingId = 'heading-' + index;
						heading.id = headingId;
					}

					const level = parseInt(heading.tagName.substring(1));
					const levelClass = 'toc-h' + level;

					tocHTML += `
						<li class="${levelClass}">
							<a href="#${headingId}" data-level="${level}">
								${heading.textContent}
							</a>
						</li>
					`;
				});

				tocList.innerHTML = tocHTML;
				initFloatingTocEvents();
			}

			function initFloatingTocEvents() {
				const tocLinks = document.querySelectorAll('#toc-floating-list a');
				const headings = document.querySelectorAll('.entry-content h1, .entry-content h2, .entry-content h3, .entry-content h4, .entry-content h5, .entry-content h6');

				if (tocLinks.length === 0) return;

				function removeActiveClasses() {
					tocLinks.forEach(link => {
						link.classList.remove('toc-active');
					});
				}

				window.addEventListener('scroll', function() {
					let current = '';
					headings.forEach(heading => {
						const headingTop = heading.getBoundingClientRect().top;
						if (headingTop <= 100) {
							current = heading.id;
						}
					});

					removeActiveClasses();
					if (current) {
						const activeLink = document.querySelector(`#toc-floating-list a[href="#${current}"]`);
						if (activeLink) {
							activeLink.classList.add('toc-active');
						}
					}
				});

				tocLinks.forEach(link => {
					link.addEventListener('click', function(e) {
						e.preventDefault();
						const targetId = this.getAttribute('href').substring(1);
						const targetElement = document.getElementById(targetId);

						if (targetElement) {
							const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 80;
							window.scrollTo({
								top: offsetTop,
								behavior: 'smooth'
							});
							setTimeout(closeToc, 300);
						}
					});
				});
			}

			// å›ºå®šå³ä¾§ç›®å½•åŠŸèƒ½
			function initFixedToc() {
				const fixedTocContainer = document.querySelector('.toc-container .toc');
				if (!fixedTocContainer) return;

				const articleContent = document.querySelector('.entry-content');
				if (!articleContent) return;

				const headings = articleContent.querySelectorAll('h1, h2, h3, h4, h5, h6');
				if (headings.length === 0) {
					fixedTocContainer.innerHTML = '<div style="color: #6b7280; text-align: center; padding: 20px; font-style: italic;">æœ¬æ–‡æš‚æ— ç›®å½•ç»“æ„</div>';
					return;
				}

				let fixedTocHTML = '';
				headings.forEach((heading, index) => {
					let headingId = heading.id;
					if (!headingId) {
						headingId = 'heading-' + index;
						heading.id = headingId;
					}

					const level = parseInt(heading.tagName.substring(1));
					fixedTocHTML += `
						<div class="toc-level-${level}">
							<a href="#${headingId}" class="toc-link">
								${heading.textContent}
							</a>
						</div>
					`;
				});

				fixedTocContainer.innerHTML = fixedTocHTML;

				const fixedTocLinks = fixedTocContainer.querySelectorAll('a');
				
				window.addEventListener('scroll', function() {
					let current = '';
					headings.forEach(heading => {
						const headingTop = heading.getBoundingClientRect().top;
						if (headingTop <= 100) {
							current = heading.id;
						}
					});

					fixedTocLinks.forEach(link => {
						link.classList.remove('active');
					});

					if (current) {
						const activeLink = fixedTocContainer.querySelector(`a[href="#${current}"]`);
						if (activeLink) {
							activeLink.classList.add('active');
							const container = fixedTocContainer;
							const activeOffset = activeLink.offsetTop;
							const containerHeight = container.clientHeight;
							const scrollTop = container.scrollTop;
							
							if (activeOffset < scrollTop || activeOffset > scrollTop + containerHeight - 50) {
								container.scrollTo({
									top: activeOffset - 50,
									behavior: 'smooth'
								});
							}
						}
					}
				});

				fixedTocLinks.forEach(link => {
					link.addEventListener('click', function(e) {
						e.preventDefault();
						const targetId = this.getAttribute('href').substring(1);
						const targetElement = document.getElementById(targetId);

						if (targetElement) {
							const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 80;
							window.scrollTo({
								top: offsetTop,
								behavior: 'smooth'
							});
						}
					});
				});
			}

			// ä¾§è¾¹æ å°éƒ¨ä»¶æ»šåŠ¨æ•ˆæœ
			function initSidebarScroll() {
				const sidebar = document.querySelector('.sidebar');
				const tocContainer = document.querySelector('.toc-container');
				const widgets = document.querySelectorAll('.sidebar > *:not(.toc-container)');
				
				if (!sidebar || !tocContainer) return;
				
				let lastScrollTop = 0;
				
				window.addEventListener('scroll', function() {
					const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
					const scrollDirection = scrollTop > lastScrollTop ? 'down' : 'up';
					
					// ä¸ºæ¯ä¸ªå°éƒ¨ä»¶åº”ç”¨æ»šåŠ¨æ•ˆæœ
					widgets.forEach((widget, index) => {
						if (scrollDirection === 'down') {
							// å‘ä¸‹æ»šåŠ¨æ—¶ï¼Œå°éƒ¨ä»¶å‘ä¸Šç§»åŠ¨
							widget.style.transform = `translateY(-${scrollTop * 0.1}px)`;
						} else {
							// å‘ä¸Šæ»šåŠ¨æ—¶ï¼Œå°éƒ¨ä»¶å‘ä¸‹ç§»åŠ¨ï¼ˆæ¢å¤ä½ç½®ï¼‰
							const translateY = Math.max(0, -scrollTop * 0.1);
							widget.style.transform = `translateY(${translateY}px)`;
						}
					});
					
					lastScrollTop = scrollTop;
				});
				
				// åˆå§‹åŒ–ä½ç½®
				widgets.forEach(widget => {
					widget.style.transition = 'transform 0.3s ease';
				});
			}

			// åˆå§‹åŒ–æ‰€æœ‰åŠŸèƒ½
			setTimeout(initFloatingToc, 100);
			setTimeout(initFixedToc, 100);
			setTimeout(initSidebarScroll, 500);
		});
		</script>

		{{ &OPT.codeBeforBody }}
	</body>
</html>
